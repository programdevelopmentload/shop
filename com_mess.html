<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">  
        <meta name="viewport" content="width=device-width, initial-scale=1"> 
		<title>公司基本信息</title>
		<link rel="stylesheet" type="text/css" href="css/base.css"/>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<link rel="stylesheet" type="text/css" href="css/bootstrapValidator.css"/>
		<link rel="stylesheet" type="text/css" href="layer/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href=""/>
		<style>
			b{
				color:#f00;
				margin-top: 5px;
				margin-right: 5px;
				font-size: 17px;
			}
			.ssx select{
				float: left;
				width: 75px;
				margin-right: 10px;
			}
			.ssx{
				/*overflow: hidden;*/
				margin-bottom: 20px;
			}
			#com_adress{margin-left: 100px}
			.store_province1 li:hover{
				background: #34BEFE;
				color: #fff;
			}
			/*.dialogs{width: 300px; height: 48px;background: #000000; opacity: .5; color: #ffffff;*/
				/*text-align: center;line-height: 48px;display: none;	}*/
		</style>
	</head>
	<body>
	<!--提示框-->
	<!--<div class="dialogs" ></div>-->
	<div class="header clearfix">
		<a href="javascript:;">
			<img src="image/xbxm.png"/>
		</a>

		<a href="javascript:;">
			<img src="image/store.png"/>
		</a>


	</div>
		<div class="mess_cont">
		   <div class="mess_cont_title">
		   	  <ul>
		   	  	<li class="clearfix">
		   	  		<span class="mess_left">供应商入驻</span>
		   	  		<a href="login.html" class="mess_right mess-padding">立即登录</a>
		   	  		<span  class="mess_right ">已有账户,</span>
		   	  	</li>
		   	  </ul>
		   </div> 
		   <div class="mess_cont_lists">
		   	  <div class="mess_cont__circle">
		   	  	 <ul class="clearfix">
		   	  	 	<li>
		   	  	 		<div class="mess_circle">1</div>
		   	  	 		<p>账号信息</p>
		   	  	 	</li>
		   	  	 	<li>
		   	  	 		<div class="mess_circle">2</div>
		   	  	 		<p>公司信息</p>
		   	  	 	</li>
		   	  	 	<li>
		   	  	 		<div class="mess_circle">3</div>
		   	  	 		<p>业务信息</p>
		   	  	 	</li>
		   	  	 </ul>
		   	  </div>
		   	   <div class="mess_con_form ">
		   	   	  <p><b>*</b>基本信息</p>
		   	   	  <form class="form-horizontal mess_list_margin" role="form" id="com_form">
					  <div class="form-group">
					    <label class="col-sm-2 control-label"><b>*</b>公司名称:</label>
					    <div class="col-sm-10">
					      <input type="text" class="form-control" id="company_name">
					      <span></span>
					    </div>
					  </div>
					  <div class="form-group ">
					  	<label  class="col-sm-2 control-label"><b>*</b>公司类型:</label>
						<input name="type"    class="mess_con_radio1" type="radio" value="1" checked="checked">综合性供应商
						<input name="type" class="mess_con_radio1" type="radio" value="2" />服务型供应商
					  </div>
					  <div class="form-group">

					    <label  class="col-sm-2 control-label"><b>*</b>公司地址:</label>
						  <div class="ssx col-sm-10">
							  <select class="form-control down store_province">

							  </select>
							  <select class="form-control store_city down ">

							  </select>
							  <select class="form-control store_area down">

							  </select>
						  </div>

					    <div class="col-sm-10">
					      <input type="text" class="form-control"  id="com_adress">
					      <span style="margin-left: 100px;"></span>
					    </div>
					  </div>
					  <div class="form-group">
					  	<label class="col-sm-2 control-label">联系电话:</label>
					    <div class="col-sm-10 mess_con_tel">
							<input type="text" class="form-control" id="lxphone">
					    </div>
					  </div>
					  <div class="form-group">
					  	<label class="col-sm-2 control-label">传真号码:</label>
					    <div class="col-sm-10">
					      <input type="text" class="form-control" id="fax_number" >
					      <!--<span></span>-->
					    </div>
					  </div>
					  <div class="form-group">
					  	<label class="col-sm-2 control-label">成立日期:</label>
					    <div class="col-sm-10">
					      <input  type="text" class="form-control" id="data" placeholder="请选择日期" >
					      <span></span>
					    </div>
					  </div>
					  <div class="form-group">
					  	<label  class="col-sm-2 control-label">公司人数:</label>
					    <div class="col-sm-10">
					      <input type="text" class="form-control" id="com_people" >
					      <!--<span></span>-->
					    </div>
					  </div>
                  </form>
		   	   </div>

		   	   <button type="button" class="btn  btn-lg mess_con_btn">提交,下一步</button>
		   </div>
		</div>
		<div class="footer">
			<p>西藏新博新美商业管理连锁股份有限公司 版权所有 CopyRight?2011-2014WWW.BOOM.COM.CN.ALL R</p>
			<p>ICP经营许可证编号：藏ICP备16000239号-1|藏公安网备54222102000009号</p>
		</div>
		<script src="js/jquery-1.12.4.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/common.js"></script>
	<script src="layer/layer.js"></script>
	<script src="layer/layui.js"></script>
		<script>
            $(".header li").click(function () {
                if($(this).html()==localStorage.getItem("username")){
                    sessionStorage.clear();
                    localStorage.clear();
                    window.location.href="basis_setting/account_msg.html"

                }else if($(this).html()=="基础设置"){
                    window.location.href="basis_setting/basis_msg.html"

                }
            });
             // 日期限制不超过当前日期
            // var date=new Date();
            // laydate.render({
            //     elem: '#data', //指定元素
            //     max:'date',
            //     format: 'yyyy-MM'
            // });

            layui.use('laydate', function(){
                var laydate = layui.laydate;

                //执行一个laydate实例
                laydate.render({
                    elem: '#data', //指定元素
                    max:'date',
                    time:"yyyy-MM"
                });
            });
            var url = getBaseUrl('ys');
            var urls=getBaseUrl('yy');
            var store_province_url = url +'/region/findAllProvince';  //一开始渲染的省
            var store_city_url =url+'/region/findAllCityByProvince';          //获取市
            var store_area_url =url+'/region/findAllAreaByCity';
            var messUrl =urls+'/user/seller/selectCompanyBycompanyid';
            var submitUrl =urls+'/user/seller/companyRegister';
            var data_id;

             //获取省
            function findAmountType(){
                $(".store_province").html('');

                $.ajax({
                    type: "post",
                    url:store_province_url,
                    headers:{
                        Authorization:localStorage.getItem("token")
                    },
                    dataType: "json",

                    success:function(res){
                        if(res.errorCode==9999){
                            window.location.href="login.html";
                        }
                        // console.log(res)
                        var data = res.data;
                        var html='';
                        for (var i = 0; i <data.length; i++) {
                            html+='<option onclick="getshi(this)" value = '+ data[i].name+'  data-id = '+data[i].id+' >'+ data[i].name+'</option>';
                        }

                        $(".store_province").html(html)

                    },
                    error:function(){

                    }
                });

            }
            findAmountType();
            //点击相对应的省获取市
		function province(){
				$.ajax({
					type: "post",
					url:store_city_url,
					data:{provinceId:data_id},
                    headers:{
                        Authorization:localStorage.getItem("token")
                    },
					dataType: "json",
					success:function(res){
						var data = res.data;
						var html='';
						for (var i = 0; i < data.length; i++) {
                            cityId=data[0].id;
							html+='<option  value = '+ data[i].name+'  data-id = '+data[i].id+' >'+ data[i].name+'</option>';
						}

						$(".store_city").html(html);
                        $.ajax({
                            type: "post",
                            url:store_area_url,
                            data:{cityId:cityId},
                            headers:{
                                Authorization:localStorage.getItem("token")
                            },
                            dataType: "json",
                            success:function(res){
                                var data = res.data;
                                //console.log(data);
                                var html='';
                                for (var i = 0; i < data.length; i++) {
                                    html+='<option value = '+ data[i].name+'  data-id = '+data[i].id+' >'+ data[i].name+'</option>';
                                }
                                $(".store_area").html(html);

                            },
                            error:function(){

                            }
                        });


					},
					error:function(){
						// console.log("报错了")
					}
				});
			}
             var cityId=0;
            $(".store_province").change(function(){
                    data_id  = $(this).find("option:selected").attr('data-id');
                province();
            });
            var boo=true;
             $(".store_province").click(function(){
				if(boo){
					data_id  = $(this).find("option:selected").attr('data-id');
					province();
				}
				boo=false;
             });
             $(".store_city").click(function(){
				 if($(this).find("option").length==1){
				     return;
				 }
                 data_id  = $(this).find("option:selected").attr('data-id');
                 store();
             });
             $(".store_city").change(function(){

                 data_id = $(this).find("option:selected").attr('data-id');
                 store()
             });
             // $(".store_area ").click(function(){
             //     data_id  =  $(".store_city").find("option:selected").attr('data-id');
             //     store();
             // });
        // $(".store_province").on("click","option",function () {
        //
        // })
            //点击相对应的市获取区
             function store(){
					$.ajax({
						type: "post",
						url:store_area_url,
						data:{cityId:data_id},
						dataType: "json",
						success:function(res){
							var data = res.data;
							//console.log(data);
							var html='';
							for (var i = 0; i < data.length; i++) {
								html+='<option value = '+ data[i].name+'  data-id = '+data[i].id+' >'+ data[i].name+'</option>';
							}
							$(".store_area").html(html);

						},
						error:function(){
							// console.log("报错了")
						}
					});
				}

              $.ajax({
                  url:messUrl,
                  data:{companyId:localStorage.getItem("companyId")},
                  dataType:"json",
                  type:"post",
                  success:function (res) {
					console.log(res);
                      var data=res.data;
                      if(res.success){
                          $("#company_name").val(data.companyName);
                          if(data.companyType=="服务型供应商"){
                              $('input:radio[value="2"]').attr("checked","checked")
                          }else{
                              $('input:radio[value="1"]').attr("checked","checked")
                          }
							$("#com_adress").val(data.companyAddress);
							$("#lxphone").val(data.telephone);
							$("#fax_number").val(data.fax);
							$("#data").val(data.foundingTime);
						  $("#com_people").val(data.peopleNum);

                      }
                  },
                  // error:function (err) {
                  // }
              });
		       var id = localStorage.getItem("userId");

		       $(".btn-lg").click(function(){
				var obj={};
				obj.companyName=$("#company_name").val();
				obj.companyType=$('input:radio[name="type"]:checked').attr("value");
				obj.companyAddress=$("#com_adress").val();
				obj.companyArea=$(".store_province").val()+","+$(".store_city").val()+","+$(".store_area").val();
				obj.telephone=$("#lxphone").val();
				obj.fax=$("#fax_number").val();
				obj.foundingTime=$("#data").val();
				obj.peopleNum=$("#com_people").val();
				obj.legalRep=$("#fr_repre").val();
				obj.legalRepPhone=$("#phone").val();
				obj.legalRepEmail=$("#email").val();
				obj.userId=id;
				if($("#com_adress").val()==""||$(".store_area").val()==""||$("#company_name").val()==""){
						confirm("请填写所有必填信息");
					return;
				}
				// console.log(obj);
		         // 提交
				$.ajax({
					url:submitUrl,
					type:"post",
                    headers: {
                        Authorization:localStorage.getItem("token")
                    },
					dataType:"json",
					data:obj,
					success:function(data){
                        // console.log(data);
                        if(data.success){
						    localStorage.setItem("companyId",data.data.companyId);
							window.location.href="supplier-mess.html?id="+data.data.companyId;
						}
						// console.log(data)
					},
					error:function(err){
						// console.log(err)
					}
				})
			});
            history.pushState({back: 1}, null, "?back=1");
            window.onpopstate = function(event) {
                console.log(event);
                history.pushState({back: 1},null, "?back=1");
            };
		</script>
	</body>
</html>
