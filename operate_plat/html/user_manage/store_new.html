<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>店铺管理-新建店铺</title>
<link rel="stylesheet" type="text/css" href="../../css/base.css"/>
<link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="../../css/bootstrap-table.min.css"/>
<link rel="stylesheet" href="../../css/font-awesome.4.6.0.css" rel="stylesheet" media="screen">
<link rel="stylesheet" href="../../css/sidebar-menu.css" rel="stylesheet" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
<link rel="stylesheet" type="text/css" href="../../css/pagination.css"/>
<link href="../../css/jquery.datetimepicker.css" type="text/css" rel="stylesheet"/>
</head>
<style type="text/css">
   	.store_new{
   		width: 100%
   	}
	.store_add{
		margin: 0 43%
	}
    .jyqy_html li{
        display: inline-block;
        margin-left: 20px;
    }
</style>
<body>

<!-- 右侧上导航 -->
<div class="verifyLog_con_right public_con yycon_right col-xs-12"> 
	<div class="store_new">
		<div class="store_name form-group form-inline">
			<label class="control-label" for="newStore_name">店铺名称:</label>
			<input class="form-control" type="text" name="" placeholder="输入新建店铺名称" id="newStore_name">
		</div>
		<div class="store_address form-group form-inline">
			<label class="control-label">所在区域:</label>
			<select class="form-control store_province">
                
            </select>
            <select class="form-control store_city">

            </select>
            <select class="form-control store_area">
                
            </select>

		</div>
		<div class="store_name form-group form-inline">
			<label class="control-label" for="newStore_detail">详细地址:</label>
			<input class="form-control" type="text" name="" placeholder="输入新建店铺名称" id="newStore_detail">
		</div>
		<div class="store_name form-group form-inline">
			<label class="control-label" for="newStore_detail">经营区域:</label>
			<ul class="jyqy_html">
                                
            </ul>
		</div>

		<button type="button" class="btn btn-primary store_add"> 确认并添加</button>
	</div>          
</div>
<script src="../../js/lib/jquery-1.12.4.min.js"></script>
<script src="../../js/lib/bootstrap.min.js"></script>
<script src="../../js/lib/sidebar-menu.js"></script>
<script src="../../js/lib/jquery.datetimepicker.js"></script>
<script src="../../js/lib/art_template.js"></script>
<script src="../../js/lib/jquery.popwin.js"></script>
<script type="text/javascript">
var localhost = 'http://172.16.38.206:8008';
var store_province_url = localhost +'/region/findSelectServerRegion';  //一开始渲染的省
var store_city_url =localhost+'/region/findSelectServerCity';          //获取市
var store_area_url =localhost+'/region/findAllAreaByCity';              //获取区

//var local= 'http://172.16.40.153:8009' 
var ServerArea = localhost+'/area/shop/findServerAreaByCityId'  

var local = 'http://172.16.40.153:8009';
var addShop= local+'/shop/addShop'

function findAmountType(){
    $(".store_province").html('');
    //获取省
    $.ajax({
        type: "post",
        url:store_province_url,
        dataType: "json",
        success:function(res){
            var data = res.data
                var html='';
                for (var i = 0; i <data.length; i++) {
                     html+='<option value = '+ data[i].provinceName+'  data-id = '+data[i].provinceId+' >'+ data[i].provinceName+'</option>';
                }
                $(".store_province").append(html)
        },
        error:function(){
             console.log("报错了")
        }
    });

}
findAmountType();


 //点击相对应的省获取市
$(".store_province").blur(function(){
    $(".store_city").html('');
    var data_id = $(this).find("option:selected").attr('data-id');
    console.log(data_id + "获取省");
     $.ajax({
        type: "post",
        url:store_city_url,
        data:{provinceId:data_id},
        dataType: "json",
        success:function(res){
            var data = res.data
                var html='';
                for (var i = 0; i < data.length; i++) {
                     html+='<option value = '+ data[i].name+'  data-id = '+data[i].id+' >'+ data[i].name+'</option>';
                }
                $(".store_city").append(html)
        },
        error:function(){
             console.log("报错了")
        }
    });
})


//点击相对应的市获取区
$(".store_city").blur(function(){
    var data_id = $(this).find("option:selected").attr('data-id');
    $('.store_area').html('');
    console.log(data_id + "城市")
     $.ajax({
        type: "post",
        url:store_area_url,
        data:{cityId:data_id},
        dataType: "json",
        success:function(res){
            var data = res.data
            //console.log(data);
                var html='';
                for (var i = 0; i < data.length; i++) {
                     html+='<option value = '+ data[i].name+'  data-id = '+data[i].id+' >'+ data[i].name+'</option>';
                }
                $(".store_area").append(html);
                randerdata(); 
        },
        error:function(){
             console.log("报错了")
        }
    });
})

// randerdata();  //这个可以写在选择完省市  开始展示区域 
function randerdata(){
    var html='';
    var html1='';
    $('.jyqy_html').html('');
    var cityId = $('.store_city').find("option:selected").attr('data-id');
    console.log(cityId+"市")
    $.ajax({
        type: "post",
        url:ServerArea,
        data:{cityId:cityId},
        dataType: "json",
        success:function(data){
            console.log(data);
            var regionInfo = data.data.regionInfo;
            var selected =data.data.selected;
            
           for (var i = 0; i < regionInfo.length; i++) {
                html1+='<li data-id='+regionInfo[i].id+' data-name='+regionInfo[i].name+'><label><input  type="checkbox" name="" id="" value="'+regionInfo[i].name+'" autocomplete="off" />'+regionInfo[i].name+'</label></li>';
            }; 
             $('.jyqy_html').append(html1);
             $('.jyqy_html li').each(function(i,v){
                for(var y=0;y<selected.length;y++){
                    if(selected[y] == $(v).attr('data-id')){
                        $(this).css('color','red');
                        $(this).find('input').attr('disabled','disabled');
                        //这里可以清除class  不让用户操作
                    }
                } 

            }) 
        },
        error:function(){
            console.log('baocuole ')
        }
    })
 }   

var reg=/^[\u0391-\uFFE5]+$/;   
$('.store_add').click(function(){
    var txt ='' ;
    var txtId = '';
    $.each($('.jyqy_html li'),function(i,v){
        if($(this).find('input').is(':checked')){
            txt+=$(this).attr('data-name')+',';
            txtId+=$(this).attr('data-id')+','

        }
        console.log(txtId);console.log(txt);
    });
    //获取店铺名 所属区域 ID  所属省份名称 所属城市名称  所属区域名称 详细地址 经营地址 经营ID
    //
     var shopName  =  $.trim($('#newStore_name').val());
     var shopAreaId = $('.store_area').find("option:selected").attr('data-id');
     var shopProvince = $('.store_province').find("option:selected").val();
     var shopCity = $('.store_city').find('option:selected').val();
     var shopArea = $('.store_area').find("option:selected").val();
     var shopAddress = $('#newStore_detail').val();
     var shopServiceArea = txt;
     var shopServiceAreaIds =txtId;
     var param = {
        shopName:shopName,
        shopAreaId:shopAreaId,
        shopProvince:shopProvince,
        shopCity:shopCity,
        shopArea:shopArea,
        shopAddress:shopAddress,
        shopServiceArea:shopServiceArea,
        shopServiceAreaIds:txtId
     }
     if(!reg.test(shopName)){      
            alert("对不起，店铺名称为中文哦!");
            $('#newStore_name').val('')      
        }
    $.ajax({
        type: "post",
        url:addShop,
        data:param,
        dataType: "json",
        success:function(res){
            alert(res.message);
            $('#newStore_name').val('');
            $('.store_province').find("option:selected").val('');
            $('.store_city').find('option:selected').val('');
            $('.store_area').find("option:selected").val('');
            $('#newStore_detail').val('');
            
        }
    })
})




</script>
</body>
</html>